# MyFirstRepo
賀年卡Demo

<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>傳說對決｜英雄賀年卡工坊</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Noto Sans TC",
        "Microsoft JhengHei", sans-serif;
      background: radial-gradient(circle at top, #233a70 0, #050814 55%, #03040a 100%);
      color: #f5f5f5;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: stretch;
    }
    .app {
      max-width: 1200px;
      width: 100%;
      padding: 24px 16px;
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
    }

    /* hero bar */
    .hero {
      width: 100%;
      margin-bottom: 8px;
      padding: 14px 18px;
      border-radius: 12px;
      background: linear-gradient(90deg, rgba(255,215,128,0.12), rgba(36,154,255,0.06));
      border: 1px solid rgba(255,215,128,0.45);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }
    .hero-left {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .logo-tag {
      font-size: 12px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: #ffd76a;
    }
    .hero-title {
      font-size: 20px;
      font-weight: 700;
    }
    .hero-subtitle {
      font-size: 12px;
      color: #c4cadc;
    }
    .hero-chip {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.3);
      font-size: 11px;
      color: #ffe49b;
      background: rgba(3,5,16,0.8);
      white-space: nowrap;
    }

    .panel {
      background: radial-gradient(circle at top left, rgba(83,132,255,0.18) 0, rgba(5,8,20,0.95) 45%, rgba(3,4,10,0.98) 100%);
      border-radius: 14px;
      padding: 18px 20px;
      border: 1px solid rgba(123,149,221,0.4);
      box-shadow: 0 10px 32px rgba(0,0,0,0.75);
    }
    .panel.controls {
      flex: 1 1 360px;
      min-width: 280px;
    }
    .panel.preview {
      flex: 1 1 360px;
      min-width: 280px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      margin: 0 0 4px;
      font-size: 18px;
    }
    .subtitle {
      font-size: 12px;
      color: #9ca3c7;
      margin-bottom: 12px;
    }

    /* stepper */
    .stepper {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }
    .stepper-item {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 8px;
      border-radius: 999px;
      background: rgba(9,12,29,0.9);
      border: 1px solid rgba(105,127,205,0.6);
      font-size: 11px;
      color: #c0c6e4;
      opacity: 0.6;
    }
    .stepper-item-number {
      width: 20px;
      height: 20px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      background: rgba(17,27,70,0.9);
      border: 1px solid rgba(137,162,255,0.9);
    }
    .stepper-item-label {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .stepper-item.active {
      opacity: 1;
      background: linear-gradient(135deg, rgba(255,215,106,0.16), rgba(75,124,255,0.28));
      border-color: rgba(255,215,106,0.9);
      color: #fff;
    }
    .stepper-item.active .stepper-item-number {
      background: linear-gradient(135deg, #ffd76a, #ffb347);
      border-color: transparent;
      color: #231200;
    }
    .stepper-item.done {
      opacity: 1;
      border-style: dashed;
      border-color: rgba(120,204,130,0.8);
    }

    label {
      display: block;
      font-size: 13px;
      margin: 8px 0 4px;
    }
    select,
    textarea,
    input[type="file"],
    input[type="text"] {
      width: 100%;
      border-radius: 8px;
      border: 1px solid rgba(91,110,177,0.8);
      padding: 8px 10px;
      font-size: 13px;
      background: rgba(10,13,30,0.96);
      color: #f5f5f5;
      outline: none;
    }
    textarea {
      resize: vertical;
      min-height: 80px;
      max-height: 220px;
    }
    select:focus,
    textarea:focus,
    input[type="text"]:focus {
      border-color: #ffd76a;
      box-shadow: 0 0 0 1px rgba(255,215,106,0.5);
    }

    .hint {
      font-size: 11px;
      color: #8088a8;
      margin-top: 2px;
    }

    .buttons {
      margin-top: 14px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    button {
      border: none;
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 13px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-weight: 600;
      transition: transform 0.08s ease, box-shadow 0.08s ease,
        background 0.15s ease, filter 0.08s ease;
    }
    button.primary {
      background: linear-gradient(135deg, #ffd76a, #ffb347);
      color: #231200;
      box-shadow: 0 6px 14px rgba(0,0,0,0.7);
    }
    button.primary:hover {
      filter: brightness(1.05);
      transform: translateY(-1px);
    }
    button.secondary {
      background: rgba(18,23,44,0.98);
      color: #e0e4ff;
      border: 1px solid rgba(140,163,255,0.7);
    }
    button.secondary:hover {
      background: rgba(28,36,70,0.98);
      transform: translateY(-1px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.7);
    }
    button.ghost {
      background: transparent;
      color: #c6ceff;
      border: 1px dashed rgba(126,145,214,0.8);
    }
    button.ghost:hover {
      background: rgba(18,23,44,0.8);
    }

    /* step content */
    .step {
      display: none;
    }
    .step.active {
      display: block;
    }

    /* canvas & preview */
    canvas {
      width: 100%;
      max-width: 340px;
      height: auto;
      border-radius: 20px;
      border: 1px solid rgba(151,170,236,0.6);
      background: #020308;
      box-shadow: 0 18px 40px rgba(0,0,0,0.9);
      transition: transform 0.25s ease;
    }
    .canvas-landscape {
      transform: rotate(90deg);
    }

    .preview-title {
      font-size: 13px;
      margin-bottom: 8px;
      color: #b4bddb;
    }
    .note {
      font-size: 11px;
      color: #8088a8;
      text-align: center;
      max-width: 340px;
      margin-top: 8px;
    }

    .preview-placeholder {
      font-size: 12px;
      color: #9ca3c7;
      text-align: center;
      padding: 32px 0 12px;
    }

    .orientation-options {
      display: flex;
      gap: 12px;
      margin: 8px 0 4px;
      flex-wrap: wrap;
    }
    .radio-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(126,145,214,0.8);
      font-size: 12px;
      cursor: pointer;
      background: rgba(10,13,30,0.96);
    }
    .radio-pill input {
      margin: 0;
    }

    .social-links {
      margin-top: 8px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .social-btn {
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 11px;
      text-decoration: none;
      border: 1px solid rgba(150,170,255,0.7);
      color: #e0e4ff;
      background: rgba(13,18,40,0.98);
    }
    .social-btn:hover {
      background: rgba(26,34,72,0.98);
    }

    @media (max-width: 768px) {
      body { align-items: flex-start; }
      .app {
        flex-direction: column;
        padding: 16px 10px;
      }
      .panel { padding: 14px 14px; }
      .hero {
        flex-direction: column;
        align-items: flex-start;
        padding: 10px 12px;
      }
      .hero-title { font-size: 18px; }
    }
    @media (max-width: 480px) {
      .hero-title { font-size: 16px; }
      .hero-subtitle { font-size: 11px; }
      h1 { font-size: 16px; }
      label { font-size: 12px; }
      select, textarea, input[type="file"], input[type="text"] {
        font-size: 12px;
      }
      .preview-title { font-size: 12px; }
      canvas { max-width: 300px; }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- 上方 Hero -->
    <div class="hero">
      <div class="hero-left">
        <div class="logo-tag">ARENA OF VALOR · SPECIAL EVENT</div>
        <div class="hero-title">英雄賀年卡工坊｜一步一步打造你的專屬祝福</div>
        <div class="hero-subtitle">
          ① 選英雄主題 → ② 編輯祝福與圖片 → ③ 預覽與下載，最後手動上傳至 IG / Threads / FB 分享給好友。
        </div>
      </div>
      <div class="hero-chip">STEP-BY-STEP UGC DEMO</div>
    </div>

    <!-- 左側：步驟流程 -->
    <div class="panel controls">
      <div class="stepper">
        <div class="stepper-item active" data-step="1">
          <div class="stepper-item-number">1</div>
          <div class="stepper-item-label">選擇英雄主題</div>
        </div>
        <div class="stepper-item" data-step="2">
          <div class="stepper-item-number">2</div>
          <div class="stepper-item-label">編輯文字 & 圖片</div>
        </div>
        <div class="stepper-item" data-step="3">
          <div class="stepper-item-number">3</div>
          <div class="stepper-item-label">預覽、下載 & 分享</div>
        </div>
      </div>

      <!-- Step 1 -->
      <div class="step active" data-step-content="1">
        <h1>步驟一：選擇英雄主題</h1>
        <div class="subtitle">
          先選一位你想一起過年的英雄，後面步驟會套用對應色系與預設台詞。
        </div>

        <label for="characterSelect">英雄主題</label>
        <select id="characterSelect">
          <option value="lubu">呂布｜赤炎戰意 · 紅金新年</option>
          <option value="diaochan">貂蟬｜冰雪舞姬 · 銀白祝福</option>
          <option value="brave">勇｜熱血少年 · 全新出發</option>
        </select>
        <div class="hint">未來正式專案可以擴充更多英雄與限定造型。</div>

        <div class="buttons">
          <button id="toStep2" type="button" class="primary">下一步：編輯內容</button>
        </div>
      </div>

      <!-- Step 2 -->
      <div class="step" data-step-content="2">
        <h1>步驟二：編輯祝福文字 & 上傳圖片</h1>
        <div class="subtitle">
          這一步是整張賀年卡的靈魂，可以寫給好友、戰隊、或是未來的自己。
        </div>

        <label for="toneText">英雄台詞（可修改）</label>
        <textarea id="toneText" rows="2"></textarea>
        <div class="hint">會以英雄口吻顯示在卡片上方，例如：新年所向披靡，戰意不滅。</div>

        <label for="messageText">你的祝福／期許</label>
        <textarea
          id="messageText"
          rows="4"
          placeholder="例：新的一年不要再 AFK，跟我一起排位上大師！&#10;或給自己的悄悄話：今年要穩住心態，好好享受每一場對戰。"
        ></textarea>

        <label for="signatureText">簽名（選填）</label>
        <input
          type="text"
          id="signatureText"
          placeholder="例：From 小白｜2025 傳說對決見"
        />

        <label for="imageUpload">上傳一張圖片（可選）</label>
        <input type="file" id="imageUpload" accept="image/*" />
        <div class="hint">
          建議使用你和朋友的合照、寵物、戰績截圖等，會放在卡片下半部。
        </div>

        <div class="buttons">
          <button id="backTo1" type="button" class="ghost">上一步：切換英雄</button>
          <button id="toStep3" type="button" class="primary">下一步：預覽與下載</button>
        </div>
      </div>

      <!-- Step 3 -->
      <div class="step" data-step-content="3">
        <h1>步驟三：預覽、選擇版型、下載 & 分享</h1>
        <div class="subtitle">
          選擇想要的方向（直式 IG 限動，或橫式 Banner），下載後手動上傳到社群平台分享。
        </div>

        <label>圖片方向（皆為 9:16 比例視覺）</label>
        <div class="orientation-options">
          <label class="radio-pill">
            <input type="radio" name="orientation" value="portrait" checked />
            <span>直式 9:16（1080 × 1920，適合 IG/Threads 限動）</span>
          </label>
          <label class="radio-pill">
            <input type="radio" name="orientation" value="landscape" />
            <span>橫式 16:9 應用（以 9:16 內容旋轉呈現）</span>
          </label>
        </div>
        <div class="hint">
          橫式下載時會自動將直式卡片旋轉，方便做 Banner 或投影使用。
        </div>

        <div class="buttons">
          <button id="backTo2" type="button" class="ghost">上一步：調整文字</button>
          <button id="refreshBtn" type="button" class="secondary">重新整理預覽</button>
          <button id="downloadBtn" type="button" class="primary">下載賀年卡 PNG</button>
        </div>

        <div class="hint" style="margin-top:8px;">
          下載後請到各平台手動上傳圖片，以下按鈕僅作為引導導流至官方社群入口。
        </div>
        <div class="social-links">
          <a class="social-btn" href="https://www.instagram.com/" target="_blank" rel="noopener noreferrer">
            前往 Instagram（IG）
          </a>
          <a class="social-btn" href="https://www.threads.net/" target="_blank" rel="noopener noreferrer">
            前往 Threads
          </a>
          <a class="social-btn" href="https://www.facebook.com/" target="_blank" rel="noopener noreferrer">
            前往 Facebook
          </a>
        </div>
      </div>
    </div>

    <!-- 右側：預覽區 -->
    <div class="panel preview">
      <div class="preview-title">預覽區</div>
      <div id="previewPlaceholder" class="preview-placeholder">
        完成步驟一、二後，請進入「步驟三」查看完整預覽與下載圖片。<br>
        （目前仍可先編輯文字，內容會即時套用到最終卡片）
      </div>
      <canvas id="cardCanvas" width="1080" height="1920" style="display:none;"></canvas>
      <div class="note">
        直式輸出可直接用於 IG / Threads 限時動態；橫式輸出則適合 Banner、投影或其他活動素材。
      </div>
    </div>
  </div>

  <script>
    const canvas = document.getElementById("cardCanvas");
    const ctx = canvas.getContext("2d");

    const characterSelect = document.getElementById("characterSelect");
    const toneText = document.getElementById("toneText");
    const messageText = document.getElementById("messageText");
    const signatureText = document.getElementById("signatureText");
    const imageUpload = document.getElementById("imageUpload");
    const refreshBtn = document.getElementById("refreshBtn");
    const downloadBtn = document.getElementById("downloadBtn");

    const stepperItems = document.querySelectorAll(".stepper-item");
    const stepPanels = document.querySelectorAll(".step");
    const previewPlaceholder = document.getElementById("previewPlaceholder");
    const orientationRadios = document.querySelectorAll('input[name="orientation"]');

    const toStep2Btn = document.getElementById("toStep2");
    const backTo1Btn = document.getElementById("backTo1");
    const toStep3Btn = document.getElementById("toStep3");
    const backTo2Btn = document.getElementById("backTo2");

    const CANVAS_WIDTH = 1080;
    const CANVAS_HEIGHT = 1920;

    const characters = {
      lubu: {
        name: "呂布",
        primaryColor: "#a4161a",
        secondaryColor: "#ffb347",
        quote: "新年所向披靡，戰意不滅！"
      },
      diaochan: {
        name: "貂蟬",
        primaryColor: "#305fce",
        secondaryColor: "#e6f3ff",
        quote: "願新年的雪，帶來溫柔與美好。"
      },
      brave: {
        name: "勇",
        primaryColor: "#ff4b4b",
        secondaryColor: "#ffe29f",
        quote: "今年也一起勇往直前，好嗎？"
      }
    };

    let uploadedImage = null;
    let currentStep = 1;
    let currentOrientation = "portrait"; // 'portrait' or 'landscape'

    function setStep(step) {
      currentStep = step;
      // 控制 stepper 樣式
      stepperItems.forEach((item) => {
        const s = parseInt(item.getAttribute("data-step"), 10);
        item.classList.remove("active", "done");
        if (s === step) {
          item.classList.add("active");
        } else if (s < step) {
          item.classList.add("done");
        }
      });
      // 控制 step panel 顯示
      stepPanels.forEach((panel) => {
        const s = parseInt(panel.getAttribute("data-step-content"), 10);
        panel.classList.toggle("active", s === step);
      });

      // 預覽區顯示控制
      if (step >= 3) {
        previewPlaceholder.style.display = "none";
        canvas.style.display = "block";
        drawCard();
      } else {
        previewPlaceholder.style.display = "block";
        canvas.style.display = "none";
      }
    }

    function syncToneWithCharacter() {
      const id = characterSelect.value;
      toneText.value = characters[id].quote;
    }

    function roundRect(ctx, x, y, w, h, r) {
      const radius = Math.min(r, w / 2, h / 2);
      ctx.beginPath();
      ctx.moveTo(x + radius, y);
      ctx.lineTo(x + w - radius, y);
      ctx.quadraticCurveTo(x + w, y, x + w, y + radius);
      ctx.lineTo(x + w, y + h - radius);
      ctx.quadraticCurveTo(x + w, y + h, x + w - radius, y + h);
      ctx.lineTo(x + radius, y + h);
      ctx.quadraticCurveTo(x, y + h, x, y + h - radius);
      ctx.lineTo(x, y + radius);
      ctx.quadraticCurveTo(x, y, x + radius, y);
      ctx.closePath();
    }

    function drawWrappedText(options) {
      const {
        ctx,
        text,
        x,
        y,
        maxWidth,
        lineHeight,
        align = "left",
        baseline = "top"
      } = options;
      if (!text) return;

      ctx.textAlign = align;
      ctx.textBaseline = baseline;

      const words = text.split("");
      let line = "";
      let yy = y;

      for (let i = 0; i < words.length; i++) {
        const testLine = line + words[i];
        const metrics = ctx.measureText(testLine);
        const testWidth = metrics.width;
        if (testWidth > maxWidth && i > 0) {
          ctx.fillText(line, x, yy);
          line = words[i];
          yy += lineHeight;
        } else {
          line = testLine;
        }
      }
      if (line) {
        ctx.fillText(line, x, yy);
      }
    }

    function drawCard() {
      const charId = characterSelect.value;
      const character = characters[charId];

      const grad = ctx.createLinearGradient(0, 0, 0, CANVAS_HEIGHT);
      grad.addColorStop(0, character.secondaryColor);
      grad.addColorStop(0.4, character.primaryColor);
      grad.addColorStop(1, "#050814");

      ctx.fillStyle = grad;
      ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

      ctx.save();
      ctx.shadowColor = "rgba(0,0,0,0.85)";
      ctx.shadowBlur = 44;
      roundRect(ctx, 80, 80, CANVAS_WIDTH - 160, CANVAS_HEIGHT - 160, 42);
      ctx.fillStyle = "rgba(5,7,20,0.86)";
      ctx.fill();
      ctx.restore();

      ctx.save();
      ctx.fillStyle = "#ffd76a";
      ctx.font =
        "700 70px 'Noto Sans TC', 'Microsoft JhengHei', system-ui, sans-serif";
      ctx.textAlign = "center";
      ctx.textBaseline = "top";
      ctx.fillText(`${character.name} 的新年祝福`, CANVAS_WIDTH / 2, 110);
      ctx.restore();

      ctx.save();
      ctx.fillStyle = "#ffffff";
      ctx.font =
        "600 46px 'Noto Sans TC', 'Microsoft JhengHei', system-ui, sans-serif";
      drawWrappedText({
        ctx,
        text: toneText.value || character.quote,
        x: CANVAS_WIDTH / 2,
        y: 230,
        maxWidth: CANVAS_WIDTH - 260,
        lineHeight: 56,
        align: "center"
      });
      ctx.restore();

      ctx.save();
      ctx.strokeStyle = "rgba(255,255,255,0.42)";
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.moveTo(180, 420);
      ctx.lineTo(CANVAS_WIDTH - 180, 420);
      ctx.stroke();
      ctx.restore();

      ctx.save();
      ctx.fillStyle = "#f5f5f5";
      ctx.font =
        "400 40px 'Noto Sans TC', 'Microsoft JhengHei', system-ui, sans-serif";
      drawWrappedText({
        ctx,
        text:
          messageText.value ||
          "在這裡寫下你想對隊友、朋友或未來的自己說的話，讓英雄幫你一起送出這份祝福。",
        x: CANVAS_WIDTH / 2,
        y: 460,
        maxWidth: CANVAS_WIDTH - 260,
        lineHeight: 52,
        align: "center"
      });
      ctx.restore();

      if (signatureText.value.trim() !== "") {
        ctx.save();
        ctx.fillStyle = "#ffd76a";
        ctx.font =
          "500 34px 'Noto Sans TC', 'Microsoft JhengHei', system-ui, sans-serif";
        ctx.textAlign = "right";
        ctx.textBaseline = "bottom";
        ctx.fillText(
          signatureText.value,
          CANVAS_WIDTH - 140,
          CANVAS_HEIGHT - 220
        );
        ctx.restore();
      }

      if (uploadedImage) {
        const areaX = 180;
        const areaY = 800;
        const areaW = CANVAS_WIDTH - 360;
        const areaH = 680;

        ctx.save();
        roundRect(ctx, areaX, areaY, areaW, areaH, 36);
        ctx.clip();

        ctx.fillStyle = "rgba(0,0,0,0.6)";
        ctx.fillRect(areaX, areaY, areaW, areaH);

        const imgRatio = uploadedImage.width / uploadedImage.height;
        const boxRatio = areaW / areaH;
        let drawW, drawH, offsetX, offsetY;

        if (imgRatio > boxRatio) {
          drawH = areaH;
          drawW = drawH * imgRatio;
        } else {
          drawW = areaW;
          drawH = drawW / imgRatio;
        }
        offsetX = areaX + (areaW - drawW) / 2;
        offsetY = areaY + (areaH - drawH) / 2;

        ctx.drawImage(uploadedImage, offsetX, offsetY, drawW, drawH);
        ctx.restore();

        ctx.save();
        ctx.lineWidth = 4;
        ctx.strokeStyle = "rgba(255,255,255,0.8)";
        roundRect(ctx, areaX, areaY, areaW, areaH, 36);
        ctx.stroke();
        ctx.restore();
      } else {
        const areaX = 180;
        const areaY = 820;
        const areaW = CANVAS_WIDTH - 360;
        const areaH = 320;

        ctx.save();
        ctx.globalAlpha = 0.22;
        ctx.fillStyle = "#051025";
        roundRect(ctx, areaX, areaY, areaW, areaH, 26);
        ctx.fill();
        ctx.restore();

        ctx.save();
        ctx.fillStyle = "rgba(255,255,255,0.75)";
        ctx.font =
          "400 34px 'Noto Sans TC', 'Microsoft JhengHei', system-ui, sans-serif";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText(
          "上傳一張照片，讓這張賀年卡更有你的味道！",
          CANVAS_WIDTH / 2,
          areaY + areaH / 2
        );
        ctx.restore();
      }

      ctx.save();
      ctx.fillStyle = "rgba(255,255,255,0.7)";
      ctx.font =
        "500 30px 'Noto Sans TC', 'Microsoft JhengHei', system-ui, sans-serif";
      ctx.textAlign = "left";
      ctx.textBaseline = "bottom";
      ctx.fillText("Garena 傳說對決｜英雄賀年卡 DEMO", 140, CANVAS_HEIGHT - 120);
      ctx.restore();

      // 根據 orientation 調整預覽旋轉
      if (currentOrientation === "landscape") {
        canvas.classList.add("canvas-landscape");
      } else {
        canvas.classList.remove("canvas-landscape");
      }
    }

    // 圖片上傳
    imageUpload.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (!file) {
        uploadedImage = null;
        if (currentStep >= 3) drawCard();
        return;
      }
      const reader = new FileReader();
      reader.onload = function (event) {
        const img = new Image();
        img.onload = function () {
          uploadedImage = img;
          if (currentStep >= 3) drawCard();
        };
        img.src = event.target.result;
      };
      reader.readAsDataURL(file);
    });

    // 步驟切換按鈕
    toStep2Btn.addEventListener("click", () => setStep(2));
    backTo1Btn.addEventListener("click", () => setStep(1));
    toStep3Btn.addEventListener("click", () => {
      setStep(3);
      drawCard();
    });
    backTo2Btn.addEventListener("click", () => setStep(2));

    // 重新整理預覽
    refreshBtn.addEventListener("click", () => drawCard());

    // 下載按鈕：直式直接輸出，橫式會旋轉成 16:9
    downloadBtn.addEventListener("click", () => {
      const charId = characterSelect.value;
      const charName = characters[charId].name;

      if (currentOrientation === "portrait") {
        const dataURL = canvas.toDataURL("image/png");
        const link = document.createElement("a");
        link.href = dataURL;
        link.download = `AoV_${charName}_英雄賀年卡_直式.png`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      } else {
        // 產生橫式 16:9 圖片（將直式畫面旋轉）
        const tempCanvas = document.createElement("canvas");
        const tempCtx = tempCanvas.getContext("2d");
        tempCanvas.width = CANVAS_HEIGHT; // 1920
        tempCanvas.height = CANVAS_WIDTH; // 1080

        tempCtx.fillStyle = "#000";
        tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);

        tempCtx.save();
        tempCtx.translate(tempCanvas.width / 2, tempCanvas.height / 2);
        tempCtx.rotate(Math.PI / 2);
        tempCtx.drawImage(
          canvas,
          -CANVAS_WIDTH / 2,
          -CANVAS_HEIGHT / 2,
          CANVAS_WIDTH,
          CANVAS_HEIGHT
        );
        tempCtx.restore();

        const dataURL = tempCanvas.toDataURL("image/png");
        const link = document.createElement("a");
        link.href = dataURL;
        link.download = `AoV_${charName}_英雄賀年卡_橫式.png`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }
    });

    // 英雄切換
    characterSelect.addEventListener("change", () => {
      syncToneWithCharacter();
      if (currentStep >= 3) drawCard();
    });

    // 文字即時更新（在 step3 才看得到）
    toneText.addEventListener("input", () => currentStep >= 3 && drawCard());
    messageText.addEventListener("input", () => currentStep >= 3 && drawCard());
    signatureText.addEventListener("input", () => currentStep >= 3 && drawCard());

    // 方向切換
    orientationRadios.forEach((radio) => {
      radio.addEventListener("change", (e) => {
        currentOrientation = e.target.value; // 'portrait' or 'landscape'
        if (currentStep >= 3) drawCard();
      });
    });

    // 初始化
    syncToneWithCharacter();
    setStep(1);
  </script>
</body>
</html>

